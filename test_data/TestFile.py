#!/usr/bin/env python
import unittest
import os
from qiime.util import get_tmp_filename
from cogent.util.misc import remove_files
from tempfile import mkdtemp
from hmmtax.assign_seq_to_taxon import unique_taxonomy_collection
from hmmtax.assign_seq_to_taxon import classify_otuID
from hmmtax.assign_seq_to_taxon import pick_otuID_from_list
from hmmtax.assign_seq_to_taxon import pick_seq,at_fasta_file,assign_otuID_to_seqs
from hmmtax.split_taxonomy import split_taxonomy_list

c_taxonomy_lines=\
['2528843	c__AAG;',
'2493663	c__Alphaproteobacteria;',
'822577	c__Alphaproteobacteria;',
'1837676	c__Alphaproteobacteria;',
'1928988	c__MBGB;',
'3770699	c__[Parvarchaea];',
'229854	c__Gammaproteobacteria;',
'2335039	c__MHVG;',
'3779572	c__Chloroplast;',
'717487	c__Alphaproteobacteria;']

otus_taxonomy_strings=\
"""2528843 k__Archaea; p__Crenarchaeota; c__AAG; o__; f__; g__; s__
2493663 k__Bacteria; p__Proteobacteria; c__Alphaproteobacteria; o__Rickettsiales; f__mitochondria; g__; s__
822577  k__Bacteria; p__Proteobacteria; c__Alphaproteobacteria; o__Rickettsiales; f__mitochondria; g__; s__
1837676 k__Bacteria; p__Proteobacteria; c__Alphaproteobacteria; o__Rickettsiales; f__mitochondria; g__; s__
1928988 k__Archaea; p__Crenarchaeota; c__MBGB; o__; f__; g__; s__
3770699 k__Archaea; p__Euryarchaeota; c__[Parvarchaea]; o__WCHD3-30; f__; g__; s__
229854  k__Bacteria; p__Proteobacteria; c__Gammaproteobacteria; o__Legionellales; f__Legionellaceae; g__Legionella; s__
2335039 k__Archaea; p__Crenarchaeota; c__MHVG; o__; f__; g__; s__
3779572 k__Bacteria; p__Cyanobacteria; c__Chloroplast; o__Streptophyta; f__; g__; s__
717487  k__Bacteria; p__Proteobacteria; c__Alphaproteobacteria; o__Rickettsiales; f__mitochondria; g__; s__"""

otu_strings=\
""">229854
GAGTTTGATCCTGGCTCAGATTGAACGCTGGCGGCATGCTTAACACATGCAAGTCGAACGGCAGCATGACTTAGCTTGCT
AAGTTGATGGCGAGTGGCGAACGGGTGAGTAACGCGTAGGAATATGCCTTAAAGAGGGGGACAACTTGGGGAAACTCAAG
CTAATACCGCATAAACTCTTCGGAGAAAAGCTGGGGACTTTCGAGCCTGGCGCTTTAAGATTAGCCTGCGTCCGATTAGC
TAGTTGGTAGGGTAAAGGCCTACCAAGGCGACGATCAGTAGCTGGTCTGAGAGGATGACCAGCCACACTGGAACTGAGAC
ACGGTCCAGACTCCTACGGGAGGCAGCAGTGGGGAATATTGGACAATGGGGGCAACCCTGATCCAGCAATGCCGCGTGTG
TGAAGAAGGCCTGAGGGTTGTAAAGCACTTTCAGTGGGGAGGAGGGTTTCCCGGTTAAGAGCTAGGGGCATTGGACGTTA
CCCACAGAAGAAGCACCGGCTAACTCCGTGCCAGCAGCCCGCGGTAATACGGGAGGGTGCAAGCGTTAATCGGAATTACT
GGGCCGTTAAAANGGTGCCTAAGGTGGTTTGGATNAGTTATGTGTTAAATTCCCTGGCGCCTCCACCCTGGNGCCAGGTC
CATANTAAAAACTGTTAAACTCCGAAGTATGGGCACAAGGTAANTTGGAAANTTCCGGTGGTNANCCGNTGAAAATGCGC
TTAGAGATNCGGGAAGGGACCACCCCAGTGGGGAAGGCGGCTACCTGGCCTAATAACTGACATTGAGGCACGAAAAGCGT
GGGGAGCAACCAGGATTAGATACCCTGGTAGTCCACGCTGTAAACGATGTCAACTAGCTGTNGGTTATATGAATATAATT
AGTGGCGAAGCTAACGCGATAAGTTGACCGCCTGGGGAGTACGGTCGCAAGATTAAAACTCAAAGGAATNGACGGGGGCC
CGCACAAGCGGTGGAGCATGTGGTTTAATTCGATGCAACGCGAAGAACCTTACCTACCCTTGACATACAGTAAATCTTTC
AGAGATGAGAGAGTGCCTTCGGGAATACTGATACAGGTGCTGCATGGCTGTCGTCAGCTCGTGTCGTGAGATGTTGGGTT
AAGTCCCGTAACGAGCGCAACCCTTATCTCTAGTTGCCAGCGAGTAATGTCGGGAACTCTAAAGAGACTGCCGGTGACAA
ACCGGAGGAAGGCGGGGACGACGTCAAGTCATCATGGCCCTTACGGGTAGGGCTACACACGTGCTACAATGGCCGATACA
GAGGGGCGCGAAGGAGCGATCTGGAGCAAATCTTATAAAGTCGGTCGTAGTCCGGATTGGAGTCTGCAACTCGACTCCAT
GAAGTCGGAATCGCTAGTAATCGCGAATCAGCATGTCGCGGTGAATACGTTCCCGGGCCTTGTACACACCGCCCGTCACA
CCATGGGAGTGGGCTGCACCAGAAGTAGATAGTCTAACCGCAAGGGGGACGTTTACCACGGTGTGGTTCATGACTGGGGT
GAAGTCGTAACAAGGTAGCCG
>1837676
AAACAATTAAGAGTTTGATCCTGGCTCTGAGTGAATGCTAGCGGCATGCCTTACACATGCAAGTCGTACGAAATTAATAAAATGATTTCGTGGCGTATAGGTGAGTAAAGTACAAAGCGTGTATGCTAAGTTTAGCTAATACTAAATATATTAACTTAATTAAGTTATTAAAGATTTTTCGCTTAGCAGACATGTTTGTATAGGATTAGGTAGTTGGTGATGGGTTTAGCTCACCAAGCCTACGATCCTTAGCTGGTCTTGGAGGACTATCAGCCACAGCGGGACGGTTACATCCCGAACTTTTTGGCAGCAGTGAGGAATATTGGACAATGGGCGCAAGCTTGATCCAGCAATGCCGCGTGGGTGAGGAAGGCTTAGATTGTAAAATCCTTTCGTCGAAGATGATAATGACAGTATTCGAAAAAGAAGCCCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAAACGGAGGGGGCTAGTGTTACTCAACTTGACTGGGCGTAAAGGGCGTGAAGGTGGTATGGTACGTTTTATTGTAAATACTCAAACATAATTTGAGGAGCTTTAAAATACGGCTATGCTTGAGTTTATTTGAAGAAAGTTGTACTTCTAGTGTAGAGGTGAAATTTGCAAAAATTAGAAGGACAGTCCACGGGCGAAAGCGACTTTCTACTATAAACTGACACTATAGCGCGAAAGCATAGGTAGCAAACGGGATTAGAGACCCCGGTAGTCTATGCAGTGACCGATGAATACTAAATGCTCTTATCCGTAAGAGAGTATTTAAGCTAACGCGTAAGTATTCCGCCTGGGAACTACAACCGCAAGGTTCAAACTTAAAGGAATTGACGGAGGGCTATTTCAGCGGTGGAGCATGTGGTTTAATCCGATATACCGCGTAGAACCTTACCAGCTCTTGATGAGCAAATCTGTTTAGGTTTAGAATCCTGAACATTCGTTTTTTTAGCGAAGTATTGGTTTGCACAGGTGTTGCATGGCTGTCGTCAGCTCGTGTTTTGAGATGTTAGGTTAACTCCTTTAACGGGCGCAACCCCCTAGCTTAATTATAAGTTTACTGCTTAGGAAATCTAAGAGGAGGGCAGGGATGATGTCAAGTCGTTATGACCTTTATGGGCTGGGCTACTCACGTGCTACAACGGTACGTACAAAGAGAAGCGAAAACGTAAGTTTTAGCAATACTCAAAAAACGTATCTCAGTTCAGATTGTACCCTGAAAATTGGATACATGAAGTTGGAATCGCTAGTAATCGTGTATCAGAATGGCACGGTGAATACCCCCTCAGCCCTAGTACACACCGCCCGTCACGCGCTGGAAATTAGTTTTGGTTGACATAAGTAGAGGATTATAATTCTTTAAGTCTAATAAAATTTAGTATCTTTAAATTGTTTTATTTTAGATTAAAATTACTGCTTATAACATTAAAGCTAAGGACTGGTGCGAAGTCGTAACAGGGTAGTCGTAGGGGAACCTGCGGCTGGACCA
>822577
AGAGTTTGATCCTGGCTCAGGGTGAACGCTAGTAGTATGCTTAACACATGCGAGTTGAACGAAGATTTATCTTAGTGGCAAACGGGTGAGTAATACATAGGAATCTGCCTTTTAGTACGGGAAAAAATCCTGTATAATACAGTAAAAAACTAAAAAAGAAATATTTTGCTAAAAGATGAGCCTATGCAGGATTAGGTAGTTGGTAAGGTTAAGGCTTACCAAGCCTGTGATCCTTAGTTGTTTTGAGAGATTGAACAACCACACTGGGACTGAGACAAGGCCCAGGCTTCAGTAGAGGCCAGCAGTGAGGAATCTTGGGCAATGAGCGAAAGCTTGACCCAGCAATATTACATGAAGGAAGACTGCTCAAAAGTTGTAAACTTCATTAATTGAGGAGGACGATTGACGTTACTTAATTAACAGCCCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAGACGAAGGGGGCGAGCGTTACCCATGATGACTGGGCGTAAAGGGTCCGTAGGCGGCTTTTTATGTTAAAAGTAAAATCAAAAAGCTTTACTTTTTGAGGCTTTTAATACGTTAGAGCTCGGAGTTTGAAGGAAGATAGTAGAATTTCATATGAAGGGGTGAAATCCGTAGAATTATGAAGGAATACTAAAGGCGAAGGCAACTATCTATTTCAATCTGACGTTGAGGGACGAAAGCATGGGGAGCAAACAGGATTAGATACCCTGGTAGTCCATGCCGTCAAAGATGAGTGCTCTTGTTTGAATTATATTTTGGACAATTAGTTAACACATAAAGCACTCCGCCTGGGGAGTACGGCCGCAAGGACGGAACTCAAAGGAATTGGCGGGGGCCTATACGAGTGGTGGAGCATGTGGTTTAATGCGACAATACGCGCGAAACCTTACCAGTTTTTGATATATATTTTGGATAATCTTTGTGGATAATCAAAAGGATTTATACAGGTGCTGCATGGCTGTCGTCAGCCCGTGTCGTAAGATGTTAGGTTCACTCTTTTTAACGGGCGAAACCCCTGTAGTTAGTTACTATTTATATATCTTATATAAAGGACTTTAACTATACTGCTTTATTGTTTAAATATTTGCTAATTGTAAACAATTAGCAACGTTAAGTGTTATTTTTTTTAAATATATTACTTGTCGTTTCAACTTATTGTTGAGTTTTTATTACAATATATAATGAGGAAGGAGGGGATGACGTCAAGTCTTTATGGCCCTTATGAACTGGGCTACACACGTGCTACAATGGTAAAGACAAAAAGAAGCAATAAGGTAACTTGGAGCTAATCTTAAAAATTTACCAAAGTTCGGATTGTGGGCTGCAACTCGCCCACATGAAGGTGGAATCACTAGTAATCACGAATCAGAACGTCGTGGTGAATTTGTACTTAGGCCTTGTACACACCGCCCGTCACGTGCCGGAAGTCGGCTTGGCTAAAAAATATTTGTTGATTATTGTGTTTAATTTTTTTATTTTTTATGTTAACAAATTTCAAAGTTTACTTTAATTTGCATAATTTATAGTCGGGTTGATAACTGGGATGAAGTCGTAACAAGGTAACC
>3770699
CGGTTGATCCTGCCGGTGGTCACTGCTATAAAATTTCGATTAAGACATGCTAGTTTAGATTTGTGTTTACATAGATCAGCGTACAGCTCAGTAATACATAATTAACATACTATCAGGTAGTGGATATCCTCGGGAAACTGAGGTTAATACACTATAATCATTAACTTCTGGAAAGATTCTATGATTAAAGCTTCGGCGCCTGATAATTGGATTATGCCTTATTAGGTCGTAGTGGGTGTAAAGGACCCCCTAGCCTACGATAAGTACGGGTCATGAGAGTGATAGCCCGGAGACGAATTCTGAGATAATAATTCGGTTACTACGGTATACCAGCAGTCGCGTAACATTCACAATGGGGGAAACCCTGATGATGGGAGTTTTAGTGCTACATTTGTAGCTGTATAGAAGTTTAAATAGCTTTTAGAGAAAGGACAGGGTAATACATGTGCCAGCCTCCGCGGTAAAACATGATGTCCAAGTGGTGATCGCTTTTATTGAGTCTAAAACGTTCGTAGCCTGTAAATTGTACCTATAGTGAAACCTACTTGCTTAACAAGTAGAATATTATAGCCATACGTTTACTAGAAATTGGATGAGGTTTGTGGTACTGCTTGGGTAGAGATAAAATCCGTTGATCCTTGCATGACCAGCGATGTAGCGAAGGCAACAAACCAATACAAATTTGACGGTCAGGAACGAAACCTAGGGTAGCAACGGGGATTAGATACCCCCTTAGTCCTAGGCGTAAACGCTGCTGACTAGATATTGGAAATTTTCAGTGTCCAAGCGAAGGCGATAAGTCAGCTACTTGAGGATTACGTCCGCAAGGATGAAACTTAAAGGAATTGGCGGGGGAGCACCGCAACGAGTGGAGCGTGCGGTTTAATTGAACCCAACGCCCGAAAACTTACCAAGAACCACTGAAAATATGAATGACAGTCTGAAGGGCTTTCTTGATTTCAGAAAGGTGGTGCATGGCCATCTCAAATTAATGCTGTGAAGTTTTCTATTAAGTTAGATAATTAATGAGATTTGCAACGTCTTTTGCTAGTCGAACTTTCGAGTTCGAAGATAAATGACGTGACTACCCGTGATAAAAAATGGGGGGAAGATGCAAGCTAAGGTAGGTCTGTATGCCCCGATGTTTCTTGGGCTACACGCGCGCTACAATGGACAAGACAACGAGTCGTGACATCGCAAGATGGAACTAATCTCTAAACTTGTTCGTAATTCGGATAGAAGTCTGTAACTCGGCTTCTTGAAGGTGGAATTCGTAGTAACTGTGGGTTAACATCCCGCGTTGAATATGCCACTGCTCCTTGCACACACCGCCCGTCAA
>2261036
TTTGATCCTGGCTCAGAATGAACGCTTAGTAACATGTCTAACACATGCAAGTCGAATGGTTTTGCACAAAACCGTGGCGAACGGGTGAGTAATGCTGAGGAAATTTACCTTATAGTCGGGGATCTCAATACCGGATTAAAAGGGCAAAATTTTGCCTGCTATAAGATAGGCCTTAGTAAGATTAGGTAGTTGGTGGAGAAAAGCCTACCAAGCCGAAGATCTTTAGCTGATTTGAGAGGATGATCGGCCACATTGGGACTGAGACACGGCCCAAACTCCCTTGGGAGGCAGCAGTGAAGAATTTTGGACAATGAACGAAAGTTTGATCCAGCAATGTTACGTGAGTGAAAGAAGGCCATTTTGGTCGTAAAGCTCTTTCAGTGAAAAAGATAATGACTTTTCACATAAGAAGTCCCGGCTAACTCCGTGCCAGCAGCCGCGGTAATACGGGGGGGGCGAGCGTTATTCGGAATGATTGGGCGTAAAGGGTCCGTAGGCGGTTTCCTAAGTTAGTTCTATAATTTTATGGGCTCAACCTTAAAAGTGAACTGAGACTAGTGAAACTACGAGTTTGAGAGGGGATAGTGGAATTCCTAGTGTAAGTATAAAATCTCTAGATATTAGGAGGAACACCAGTAGGCGAAGGCGACTATCTGGCTCAAAACTGACGCTGAGGGACGAAAGTATGGGTATCGAATGGGATTAGAGACCCCAGTAGTCCATACCGTAAACGATGAGTGTTATATATTCGGATTTTTCATTTTACTGTAATTTTAATTTGTAAAATTACGGTCGCGCTTCATAAATATATCTTTTAGATATAAAAACGTGCATTTAAGTCCTGAATTAACAAGTATTAGTTATTAATTTAACAATCTTTTTTTATTTATTTTTATTGTTTAACAATTTTAAAAATCTGAGTATATTTATAAATATTTATAAAGCTAACGCGTTAAACACTCCGCCTGGGGAGTACAGTCGCAAGACCGAAACTCAAAGGAATTGACGGGGGCCCACACAAGCGGTGGGGTATGTGGTTTAATGCGATGATACGCGCAAAACCTTACCAGCTCTTGCATTTGACTATGATAATTTGATCTATAATGACATCTTAAAGAAGATTTTTGCCGACAAATCTTCATTACACTACCCTGGTATCGGATTGATTTGTATGTAACACAAAATATGTTACATTTGGTTATATGTTATGCAAGATGAAATAGATTTCATCTTTTTAAATAGAGTCAAACAGGTGTTGCATGGCTGTCGTCAGCTCGTGTTGTGAAATGTTTGGTTAATTCCTTTAACGAGCGTAACCCCTAGATTTGAGGTTTCATTTTGAATTTGCAAAATTAAATTTCAAATCTACTGCCATTTATATATTAGAGGAAGGTGGGGATGACGTCAAGTCCGCATGGCCCTTATGAGCTGGGCTACACACATGCTACAATGGCAATGACAGTGAGAAGCAATGGCGTGAGCCGGAGCAATTCTATAAACGTTGCCTTAGTACGGATTGTAGGCTGCAACTCGCCTACATGAAGTTGGAATCGCTAGTAATCGTAGATCAGCACGCTACGGTGAATTAGTACTTGGGCCTTGTACATACCGCCCGTCACACCCTGGAAATTGTTTCTAATTGAAGCTTGTTACCTAACCGTAAGGAGGGAATCTGTGAGATTGGAGAGAGTGACTGGGGTGAAGTCGTAACAAGGTAGCTGTAGGGGAACCTGCTGCTGGAAC
>2051943
GGGAGCTTGCTCCCTGATATCAGCGGCGGACGGGTGAGTAACACGTGGGTAACCTGCCTGTAAGACTGGGATAACTCCGGGAAACCGGGGCTAATACCGGATAACTCATTTCCTCGCATGAGGAAATGTTGAAAGGTGGCTTCTGCTACCACTTACCGATGGGCCCGCGGCGCCTTTACTAGTTGGGGGGGGAACGGCTCCCCCAGGCCACGATGCCTAGCCCACCTGGGAGGGTGGTCGGCCACCCTGGGACTGAAACCCCGCCCCAACTCCTACCGGAGGCAGCAGTAGGGAATCTTTCGCCATGGACGAAAGTCTGACGGAACCACCCCGCGTGAGTGATGGAGGGTTTCCGATCCTAAAGCTCTGGTGGTAAGGAAAAACCAGTGCCGGTCCAATAGGGCGGCACCTTGGCGGTACCTAACCCAAAAGCCACGGCTTACTACGTGGCAGCAGCCGGCGTAATACGTAGGTGGCAAGCGTTGTCCGGAATTATTGGGCGTAAAGCGCGCGCCGGGGGTTCCTTAAGTCTTATGGGAAGCCCCCCGCTTCACCGTTGAGGGNCATTGGAAACTGGGGAACTTGAGTGCCAAAGAAGGAAGGGAATTTCCAGTGGTGCGGTGAATGCGTAGATTATGGAGAACCCCGNGGCGAGGCGACTTTCTTGTCTGGTACTGACACCTGAAGCGCCAAAGCGTGGGGGCAACAGAATAGATACTCCTGAGTCCACGCGTAACCGATGAGNCTAGTGTAGGGGCTCTAGTGCTGCAGCTACGCATAAGCACTCGCTGGGAGTACTGTCGCAGACTGATACTCTGATAGTGAAAAGCCCCACGCGCTCAACCCGTGGGAAGGGGTCATTGGAAAACTGGGGGAACCTTGAGGTGCAGAAAGAAGGAAAAGTGGAATTCCCAAGTGTAGCGGTGAAAATGCGATAGAGATTTTGGAGGAACACCCAGTGGCGAAAGGCGACTTTTCTGGTCTGTAACCTGACACTGAGGCGCGAAAAGCGTGGGGAGCAAACAGGATTAGATACCCTGGTAGTCCACGCCGTAAACCGATGAGTGCTAAGTGTTAGGGGGTTTCCGCCCCTTAGTGCTGCAGCTAACGCATTAAGCACTCCGCCTGGGGAGTACGGTCGCAAGACTGAAAACTCAAAGGAATTTGACGGGGCCCCGCACAAGCGGTGGAGCATGTGGTTTAATTTCGAAGCAACGCGAAGAACCTTACCAGGTCTTGACATCCTCTGACAACCCTAGAGATAGGGCTTTCCCCTTCGGGGGACAGAGTGACAGGTGGTGCATGGTTGTCGTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCGCAACGAGCGCAACCCTTGATCTTAGTTGCCAGCATTCAGTTGGGCACTCTAAGATGACTGCCGGTGACAAACCGGAGGAAGGTGGGGATGACGTCAAATCATCATGCCCCTTATGACCTGGGCTACACACGTGCTACAATGGACGGTACAAAGGGCAGCGAGACCGCGAGGTTTAGCCAATCCCATAAAACCGTTCTCAGTTCGGATTGTAGGCTGCAACTCGCCTACATGAAGCTGGAATCGCTAGTAATCGCGGATCAGCATGCCGCGGTGAATACGTTCCCGGGCCTTGTACACACCGCCCGTCACCCCACGAGAGTTTGTAACACCCGAAGTCGTTGAGTTA
""" 

class SequenceTest(unittest.TestCase):
    
    def setUp(self):
	    self.otu_f=get_tmp_filename(
	        prefix='OtuTaxonomyTest_',suffix='.txt')	
	    self.otu_match_f=get_tmp_filename(
	        prefix='OtuMatchTest',suffix='fasta')
	    self._paths_to_clean_up=\
	        [self.otu_f,self.otu_match_f]

	    otu_file=open(self.otu_f,'w')
	    otu_match=open(self.otu_match_f,'w')
	
	    otu_file.write(otus_taxonomy_strings)
	    otu_match.write(otu_strings)
	
	    otu_file.close()
	    otu_match.close()
		
    def tearDown(self):
	
	    remove_files(set(self._paths_to_clean_up))
    
    def test_unique_taxonomy_collection(self):
    
        expected=['c__AAG;','c__Alphaproteobacteria;','c__MBGB;','c__[Parvarchaea];',\
	          'c__Gammaproteobacteria;','c__MHVG;','c__Chloroplast;']
	    actual=unique_taxonomy_collection(c_taxonomy_lines)
        self.assertEqual(actual,expected)

    def test_classify_otuID(self):
        
	    taxonomy_collection=['c__AAG;','c__Alphaproteobacteria;','c__MBGB;',\
			                 'c__[Parvarchaea];','c__Gammaproteobacteria;',\
			                 'c__MHVG;','c__Chloroplast;']
	
	    expected=[['c__AAG;','2528843'],\
                  ['c__Alphaproteobacteria;','2493663','822577','1837676','717487'],\
                  ['c__MBGB;','1928988'],\
		          ['c__[Parvarchaea];','3770699'],\
                  ['c__Gammaproteobacteria;','229854'],\
		          ['c__MHVG;','2335039'], ['c__Chloroplast;','3779572']]

	    actual=classify_otuID(taxonomy_collection,c_taxonomy_lines)
        self.assertEqual(actual,expected)

    
    def test_pick_otuID_from_list1(self):
	
        tgroup_list=[['c__AAG;','2528843'],\
                     ['c__Alphaproteobacteria;','2493663','822577','1837676','717487'],\
                     ['c__MBGB;','1928988'],\
		             ['c__[Parvarchaea];','3770699'],['c__Gammaproteobacteria;','229854'],\
		             ['c__MHVG;','2335039'], ['c__Chloroplast;','3779572']]

        utc='c__Alphaproteobacteria;'

        expected=['2493663','822577','1837676','717487']

    	actual=pick_otuID_from_list(utc,tgroup_list)
	    self.assertEqual(actual,expected)

    def test_pick_seq(self):
	
	    otu_files=['../gg_12_10_otus/rep_set/61_otus.fasta']
	    identify_number='2493663'
	    expected="""ATGCTTAACACATGCAAGTCGAACAATTTGGGGCTATTGGAAGCTCCTAGCTTTGCAGCTTGTCTCTCTCTTTTGATAGGAGACTTTGATAATGAAGTGGCGAACGGGTGCGTAAGGCGTGGGAAATTCTGCCGGAGAGAAAGCTAACGAAGAGCACTCCTTGATGAGCCCGCGTAGTATTAGGTAGTTGGTTAGGTTACGGCTGACCAAGCCGATGATGCTTAGTTGATCTTTTCGGATGATCAGCCACACCGGGACTGAGACAAGGCCCGGACCCAGGATTGGGGCAGCAGTGGGGAATCTTGGACAATAGGCGCCAGCCCGATCCAGCAATCTTGCGTGATTTAGACTCGTAAGGAGCCCGCCGGAGTGCGGGGATCTAGGGCACTTTCGCTTGTAAAAGCTCTTTCAACGAGTATGCGATGATGACATGACTCGTGTAAGAAGCTCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAGACGAAGGGGGCAAGTCTTTCTCGGAATGACTGGGCGTAAAGAGCATGTAGGCGGTCAGTCAAATTGGAGCGGAAAAGCGCCATACAGATGGTGAGGTGTTCCCAATAAGACTGACTTGGGTCAGATAAGGGAGAGTGGAATTTCGTAGGGAGTTGGAAGAACACCTAAATCTATGTAAGGCAGTCCTAAGGCGAAGGCAGCTCTCTAGGTCTATACCGACGCTAAATGTGCGAAAGCGTGGGTAGCAAACAGGATTAGAGACCCTGGTAGTCCACGCTGTCAACGATGAGTGTTAGCTGTTTGGTCGTGTGATCAGGAGCACAGCTAACGCGTGAAACACTCCGCCTGGGGAGTACAGTCGCAAGGCTGAAACTCAAAGGAATTGACGGGGGCCCGCATAAGCGGTGGAGCATGTGGTTTAATTCGATACAACGCGAAAGGATCTTACCAGCCTTTGAATATGAGATCGTAGGCAAGGAGACGGGGGAGTTTGAATAAGGGCCAATTATGATAAGAAGACGCTTCTACCCTAATCGCTCCCTCCAATTATGAAAAGAATGAGATCCCATACCTTTTTTCCTCGCGACTAGCCAGGAGGATGAAGCTTAGTACGCTTTCGTACAGGTGTTGCATGGCTGTCGTCAGTCCGTGTCGTGGGATGTCGGGTCAATTCCTATAACGGGCGAAACCCTTTTTTTGTGTTGCAGAACACGTGTATCCTAGGCTTCGGGATTCTAAGTGGTAATACAGAGGAGTATACCATAACCAGCCCATGAATTAGAGAGGGTGCGCGTCGCACTCACAAGAGACAGACGCTTATATGGTGTAGGAAGGTGGGGATGACGTCAAGTCCGCATGGTCCTTAAAGGCTGGGCCACACACGTGCTACAATGACAATTACAATGGGATGTGAAAACTGCACCCTCAAAGATTGTCGCAGTTCGGATTCCTCTCTGTAATTCGGGAGGATGAAGCAGGAATCGCTAGTAATCGCGGATTAGGATGCCGCGGTGAACTGAGAACCGGGTTTTGTACACACCGCCCGTCACACCCTGGGAATTGGTTTCGCCCTAAGCATCAACGCGGAGGTTGCCCATGACTTGCTTCTGGTTTCTTTGCCATGGAGTGTTCCTTGGCAGTCTTTGTTGGATACCACGGTGGGGTCTCTGACTGGGGTGAAGTCGTAACAAGGTAGCCGTAGGGGA
"""
	    actual=pick_seq(otu_files, identify_number)
	    self.assertEqual(actual,expected)

    def test_at_fasta_file(self):
        
	    ID_nucleoSeq=['2493663','ATGCTTAACACATGCAAGTCGAACAATTTGGGGCTATTGGAAGCTCCTAGCTTTGCAGCTTGTCTCTCTCTTTTGATAGGAGACTTTGATAATGAAGTGGCGAACGGGTGCGTAAGGCGTGGGAAATTCTGCCGGAGAGAAAGCTAACGAAGAGCACTCCTTGATGAGCCCGCGTAGTATTAGGTAGTTGGTTAGGTTACGGCTGACCAAGCCGATGATGCTTAGTTGATCTTTTCGGATGATCAGCCACACCGGGACTGAGACAAGGCCCGGACCCAGGATTGGGGCAGCAGTGGGGAATCTTGGACAATAGGCGCCAGCCCGATCCAGCAATCTTGCGTGATTTAGACTCGTAAGGAGCCCGCCGGAGTGCGGGGATCTAGGGCACTTTCGCTTGTAAAAGCTCTTTCAACGAGTATGCGATGATGACATGACTCGTGTAAGAAGCTCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAGACGAAGGGGGCAAGTCTTTCTCGGAATGACTGGGCGTAAAGAGCATGTAGGCGGTCAGTCAAATTGGAGCGGAAAAGCGCCATACAGATGGTGAGGTGTTCCCAATAAGACTGACTTGGGTCAGATAAGGGAGAGTGGAATTTCGTAGGGAGTTGGAAGAACACCTAAATCTATGTAAGGCAGTCCTAAGGCGAAGGCAGCTCTCTAGGTCTATACCGACGCTAAATGTGCGAAAGCGTGGGTAGCAAACAGGATTAGAGACCCTGGTAGTCCACGCTGTCAACGATGAGTGTTAGCTGTTTGGTCGTGTGATCAGGAGCACAGCTAACGCGTGAAACACTCCGCCTGGGGAGTACAGTCGCAAGGCTGAAACTCAAAGGAATTGACGGGGGCCCGCATAAGCGGTGGAGCATGTGGTTTAATTCGATACAACGCGAAAGGATCTTACCAGCCTTTGAATATGAGATCGTAGGCAAGGAGACGGGGGAGTTTGAATAAGGGCCAATTATGATAAGAAGACGCTTCTACCCTAATCGCTCCCTCCAATTATGAAAAGAATGAGATCCCATACCTTTTTTCCTCGCGACTAGCCAGGAGGATGAAGCTTAGTACGCTTTCGTACAGGTGTTGCATGGCTGTCGTCAGTCCGTGTCGTGGGATGTCGGGTCAATTCCTATAACGGGCGAAACCCTTTTTTTGTGTTGCAGAACACGTGTATCCTAGGCTTCGGGATTCTAAGTGGTAATACAGAGGAGTATACCATAACCAGCCCATGAATTAGAGAGGGTGCGCGTCGCACTCACAAGAGACAGACGCTTATATGGTGTAGGAAGGTGGGGATGACGTCAAGTCCGCATGGTCCTTAAAGGCTGGGCCACACACGTGCTACAATGACAATTACAATGGGATGTGAAAACTGCACCCTCAAAGATTGTCGCAGTTCGGATTCCTCTCTGTAATTCGGGAGGATGAAGCAGGAATCGCTAGTAATCGCGGATTAGGATGCCGCGGTGAACTGAGAACCGGGTTTTGTACACACCGCCCGTCACACCCTGGGAATTGGTTTCGCCCTAAGCATCAACGCGGAGGTTGCCCATGACTTGCTTCTGGTTTCTTTGCCATGGAGTGTTCCTTGGCAGTCTTTGTTGGATACCACGGTGGGGTCTCTGACTGGGGTGAAGTCGTAACAAGGTAGCCGTAGGGGA']

            expected=""">2493663
ATGCTTAACACATGCAAGTCGAACAATTTGGGGCTATTGGAAGCTCCTAGCTTTGCAGCTTGTCTCTCTCTTTTGATAGGAGACTTTGATAATGAAGTGGCGAACGGGTGCGTAAGGCGTGGGAAATTCTGCCGGAGAGAAAGCTAACGAAGAGCACTCCTTGATGAGCCCGCGTAGTATTAGGTAGTTGGTTAGGTTACGGCTGACCAAGCCGATGATGCTTAGTTGATCTTTTCGGATGATCAGCCACACCGGGACTGAGACAAGGCCCGGACCCAGGATTGGGGCAGCAGTGGGGAATCTTGGACAATAGGCGCCAGCCCGATCCAGCAATCTTGCGTGATTTAGACTCGTAAGGAGCCCGCCGGAGTGCGGGGATCTAGGGCACTTTCGCTTGTAAAAGCTCTTTCAACGAGTATGCGATGATGACATGACTCGTGTAAGAAGCTCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAGACGAAGGGGGCAAGTCTTTCTCGGAATGACTGGGCGTAAAGAGCATGTAGGCGGTCAGTCAAATTGGAGCGGAAAAGCGCCATACAGATGGTGAGGTGTTCCCAATAAGACTGACTTGGGTCAGATAAGGGAGAGTGGAATTTCGTAGGGAGTTGGAAGAACACCTAAATCTATGTAAGGCAGTCCTAAGGCGAAGGCAGCTCTCTAGGTCTATACCGACGCTAAATGTGCGAAAGCGTGGGTAGCAAACAGGATTAGAGACCCTGGTAGTCCACGCTGTCAACGATGAGTGTTAGCTGTTTGGTCGTGTGATCAGGAGCACAGCTAACGCGTGAAACACTCCGCCTGGGGAGTACAGTCGCAAGGCTGAAACTCAAAGGAATTGACGGGGGCCCGCATAAGCGGTGGAGCATGTGGTTTAATTCGATACAACGCGAAAGGATCTTACCAGCCTTTGAATATGAGATCGTAGGCAAGGAGACGGGGGAGTTTGAATAAGGGCCAATTATGATAAGAAGACGCTTCTACCCTAATCGCTCCCTCCAATTATGAAAAGAATGAGATCCCATACCTTTTTTCCTCGCGACTAGCCAGGAGGATGAAGCTTAGTACGCTTTCGTACAGGTGTTGCATGGCTGTCGTCAGTCCGTGTCGTGGGATGTCGGGTCAATTCCTATAACGGGCGAAACCCTTTTTTTGTGTTGCAGAACACGTGTATCCTAGGCTTCGGGATTCTAAGTGGTAATACAGAGGAGTATACCATAACCAGCCCATGAATTAGAGAGGGTGCGCGTCGCACTCACAAGAGACAGACGCTTATATGGTGTAGGAAGGTGGGGATGACGTCAAGTCCGCATGGTCCTTAAAGGCTGGGCCACACACGTGCTACAATGACAATTACAATGGGATGTGAAAACTGCACCCTCAAAGATTGTCGCAGTTCGGATTCCTCTCTGTAATTCGGGAGGATGAAGCAGGAATCGCTAGTAATCGCGGATTAGGATGCCGCGGTGAACTGAGAACCGGGTTTTGTACACACCGCCCGTCACACCCTGGGAATTGGTTTCGCCCTAAGCATCAACGCGGAGGTTGCCCATGACTTGCTTCTGGTTTCTTTGCCATGGAGTGTTCCTTGGCAGTCTTTGTTGGATACCACGGTGGGGTCTCTGACTGGGGTGAAGTCGTAACAAGGTAGCCGTAGGGGA
"""
        
        self.output_f=get_tmp_filename(
	    prefix='SplitTaxonomyTest_',suffix='.fasta')

	    self._paths_to_clean_up.append(self.output_f)
	
	    at_fasta_file(ID_nucleoSeq,self.output_f)
	
	    result=open(self.output_f,'U')
	    self.assertEqual(result.read(),expected)
	    result.close()
    
    def test_assign_otuID_to_seqs(self):
	
	    expected="""\
>822577
AGAGTTTGATCCTGGCTCAGGGTGAACGCTAGTAGTATGCTTAACACATGCGAGTTGAACGAAGATTTATCTTAGTGGCAAACGGGTGAGTAATACATAGGAATCTGCCTTTTAGTACGGGAAAAAATCCTGTATAATACAGTAAAAAACTAAAAAAGAAATATTTTGCTAAAAGATGAGCCTATGCAGGATTAGGTAGTTGGTAAGGTTAAGGCTTACCAAGCCTGTGATCCTTAGTTGTTTTGAGAGATTGAACAACCACACTGGGACTGAGACAAGGCCCAGGCTTCAGTAGAGGCCAGCAGTGAGGAATCTTGGGCAATGAGCGAAAGCTTGACCCAGCAATATTACATGAAGGAAGACTGCTCAAAAGTTGTAAACTTCATTAATTGAGGAGGACGATTGACGTTACTTAATTAACAGCCCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAGACGAAGGGGGCGAGCGTTACCCATGATGACTGGGCGTAAAGGGTCCGTAGGCGGCTTTTTATGTTAAAAGTAAAATCAAAAAGCTTTACTTTTTGAGGCTTTTAATACGTTAGAGCTCGGAGTTTGAAGGAAGATAGTAGAATTTCATATGAAGGGGTGAAATCCGTAGAATTATGAAGGAATACTAAAGGCGAAGGCAACTATCTATTTCAATCTGACGTTGAGGGACGAAAGCATGGGGAGCAAACAGGATTAGATACCCTGGTAGTCCATGCCGTCAAAGATGAGTGCTCTTGTTTGAATTATATTTTGGACAATTAGTTAACACATAAAGCACTCCGCCTGGGGAGTACGGCCGCAAGGACGGAACTCAAAGGAATTGGCGGGGGCCTATACGAGTGGTGGAGCATGTGGTTTAATGCGACAATACGCGCGAAACCTTACCAGTTTTTGATATATATTTTGGATAATCTTTGTGGATAATCAAAAGGATTTATACAGGTGCTGCATGGCTGTCGTCAGCCCGTGTCGTAAGATGTTAGGTTCACTCTTTTTAACGGGCGAAACCCCTGTAGTTAGTTACTATTTATATATCTTATATAAAGGACTTTAACTATACTGCTTTATTGTTTAAATATTTGCTAATTGTAAACAATTAGCAACGTTAAGTGTTATTTTTTTTAAATATATTACTTGTCGTTTCAACTTATTGTTGAGTTTTTATTACAATATATAATGAGGAAGGAGGGGATGACGTCAAGTCTTTATGGCCCTTATGAACTGGGCTACACACGTGCTACAATGGTAAAGACAAAAAGAAGCAATAAGGTAACTTGGAGCTAATCTTAAAAATTTACCAAAGTTCGGATTGTGGGCTGCAACTCGCCCACATGAAGGTGGAATCACTAGTAATCACGAATCAGAACGTCGTGGTGAATTTGTACTTAGGCCTTGTACACACCGCCCGTCACGTGCCGGAAGTCGGCTTGGCTAAAAAATATTTGTTGATTATTGTGTTTAATTTTTTTATTTTTTATGTTAACAAATTTCAAAGTTTACTTTAATTTGCATAATTTATAGTCGGGTTGATAACTGGGATGAAGTCGTAACAAGGTAACC

>1837676
AAACAATTAAGAGTTTGATCCTGGCTCTGAGTGAATGCTAGCGGCATGCCTTACACATGCAAGTCGTACGAAATTAATAAAATGATTTCGTGGCGTATAGGTGAGTAAAGTACAAAGCGTGTATGCTAAGTTTAGCTAATACTAAATATATTAACTTAATTAAGTTATTAAAGATTTTTCGCTTAGCAGACATGTTTGTATAGGATTAGGTAGTTGGTGATGGGTTTAGCTCACCAAGCCTACGATCCTTAGCTGGTCTTGGAGGACTATCAGCCACAGCGGGACGGTTACATCCCGAACTTTTTGGCAGCAGTGAGGAATATTGGACAATGGGCGCAAGCTTGATCCAGCAATGCCGCGTGGGTGAGGAAGGCTTAGATTGTAAAATCCTTTCGTCGAAGATGATAATGACAGTATTCGAAAAAGAAGCCCCGGCTAACTTCGTGCCAGCAGCCGCGGTAAAACGGAGGGGGCTAGTGTTACTCAACTTGACTGGGCGTAAAGGGCGTGAAGGTGGTATGGTACGTTTTATTGTAAATACTCAAACATAATTTGAGGAGCTTTAAAATACGGCTATGCTTGAGTTTATTTGAAGAAAGTTGTACTTCTAGTGTAGAGGTGAAATTTGCAAAAATTAGAAGGACAGTCCACGGGCGAAAGCGACTTTCTACTATAAACTGACACTATAGCGCGAAAGCATAGGTAGCAAACGGGATTAGAGACCCCGGTAGTCTATGCAGTGACCGATGAATACTAAATGCTCTTATCCGTAAGAGAGTATTTAAGCTAACGCGTAAGTATTCCGCCTGGGAACTACAACCGCAAGGTTCAAACTTAAAGGAATTGACGGAGGGCTATTTCAGCGGTGGAGCATGTGGTTTAATCCGATATACCGCGTAGAACCTTACCAGCTCTTGATGAGCAAATCTGTTTAGGTTTAGAATCCTGAACATTCGTTTTTTTAGCGAAGTATTGGTTTGCACAGGTGTTGCATGGCTGTCGTCAGCTCGTGTTTTGAGATGTTAGGTTAACTCCTTTAACGGGCGCAACCCCCTAGCTTAATTATAAGTTTACTGCTTAGGAAATCTAAGAGGAGGGCAGGGATGATGTCAAGTCGTTATGACCTTTATGGGCTGGGCTACTCACGTGCTACAACGGTACGTACAAAGAGAAGCGAAAACGTAAGTTTTAGCAATACTCAAAAAACGTATCTCAGTTCAGATTGTACCCTGAAAATTGGATACATGAAGTTGGAATCGCTAGTAATCGTGTATCAGAATGGCACGGTGAATACCCCCTCAGCCCTAGTACACACCGCCCGTCACGCGCTGGAAATTAGTTTTGGTTGACATAAGTAGAGGATTATAATTCTTTAAGTCTAATAAAATTTAGTATCTTTAAATTGTTTTATTTTAGATTAAAATTACTGCTTATAACATTAAAGCTAAGGACTGGTGCGAAGTCGTAACAGGGTAGTCGTAGGGGAACCTGCGGCTGGACCA

"""


	    self.output_dir=mkdtemp(prefix='TaxonomyTest_')
	    taxonomy_level=5
	    otu_f_list=[]
	    otu_match_list=[]
	    otu_f_list.append(self.otu_f)
	    otu_match_list.append(self.otu_match_f)
	
	    sub_taxonomy_list=[]
	    sub_taxonomy=split_taxonomy_list(otu_f_list,taxonomy_level,self.output_dir)	
	    sub_taxonomy_list.append(sub_taxonomy)
	    assign_otuID_to_seqs(sub_taxonomy_list,otu_match_list,self.output_dir) 

	    output_taxon_fp=os.path.join(self.output_dir,'c_taxonomy','c__Alphaproteobacteria.fasta')
	    result=open(output_taxon_fp,'U')
	    self.assertEqual(result.read(),expected)
	    result.close()


if __name__=='__main__':
    unittest.main()

